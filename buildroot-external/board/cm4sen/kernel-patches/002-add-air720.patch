From 3d2808e455f90098755c442f614d7990b77fc22f Mon Sep 17 00:00:00 2001
From: Harry Rong <harrykobe@gmail.com>
Date: Sat, 5 Mar 2022 16:11:37 +0800
Subject: [PATCH] add Air 720

---
 drivers/usb/serial/option.c   |  7 +++++++
 drivers/usb/serial/usb_wwan.c | 14 ++++++++++++++
 2 files changed, 21 insertions(+)

diff --git a/drivers/usb/serial/option.c b/drivers/usb/serial/option.c
index c7356718a7c6..7c2b486b0a27 100644
--- a/drivers/usb/serial/option.c
+++ b/drivers/usb/serial/option.c
@@ -585,6 +585,10 @@ static void option_instat_callback(struct urb *urb);
 
 
 static const struct usb_device_id option_ids[] = {
+	//+add by airm2m for Air72x
+    { USB_DEVICE(0x1782, 0x4e00) },    /* 720U 系列*/
+    { USB_DEVICE(0x1286, 0x4e3d) },    /* 720 系列*/
+    //-add by airm2m for Air72x
 	{ USB_DEVICE(OPTION_VENDOR_ID, OPTION_PRODUCT_COLT) },
 	{ USB_DEVICE(OPTION_VENDOR_ID, OPTION_PRODUCT_RICOLA) },
 	{ USB_DEVICE(OPTION_VENDOR_ID, OPTION_PRODUCT_RICOLA_LIGHT) },
@@ -2133,6 +2137,9 @@ static struct usb_serial_driver option_1port_device = {
 #ifdef CONFIG_PM
 	.suspend           = usb_wwan_suspend,
 	.resume            = usb_wwan_resume,
+	//+add by airm2m for Air720
+    .reset_resume      = usb_wwan_resume,
+    //-add by airm2m for Air720
 #endif
 };
 
diff --git a/drivers/usb/serial/usb_wwan.c b/drivers/usb/serial/usb_wwan.c
index b2285d5a869d..4ca3aecb9bd8 100644
--- a/drivers/usb/serial/usb_wwan.c
+++ b/drivers/usb/serial/usb_wwan.c
@@ -480,6 +480,20 @@ static struct urb *usb_wwan_setup_urb(struct usb_serial_port *port,
 	if (intfdata->use_zlp && dir == USB_DIR_OUT)
 		urb->transfer_flags |= URB_ZERO_PACKET;
 
+	//+add by airm2m for Air72x
+    if(dir == USB_DIR_OUT){
+        struct usb_device_descriptor *desc = &serial->dev->descriptor;
+        if((desc->idVendor == cpu_to_le16(0x1286) && desc->idProduct == cpu_to_le16(0x4e3d))   )  /* 720 系列*/
+        {
+            urb->transfer_flags |= URB_ZERO_PACKET;
+        }
+        if((desc->idVendor == cpu_to_le16(0x1782) && desc->idProduct == cpu_to_le16(0x4e00))  )   /* 720U 系列*/
+        { 
+			urb->transfer_flags |= URB_ZERO_PACKET;
+        }
+    }
+    //-add by airm2m for Air72x
+
 	return urb;
 }
 
-- 
2.18.0

